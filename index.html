<!DOCTYPE html>
<html lang="en">
<!--
  OpenSCAD Metaball Quick Editor

  This page implements a lightweight metaball editor and generator.  Each
  metaball is defined by a centre point (x,y) and a radius.  The editor
  allows you to add and remove balls, drag them around with the mouse and
  change their radius with the mouse wheel.  It provides a simple 2-D
  preview that calculates a scalar field for the balls and shades all
  pixels above the chosen threshold.  The generated OpenSCAD code uses
  BOSL2's metaballs function from isosurface.scad: the spec list is
  emitted as pairs of transforms and mb_sphere() calls.

  The preview does not rely on any external libraries or network
  resources; everything is implemented in vanilla JavaScript.
-->

<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <title>Metaball Editor for OpenSCAD</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div id="container">
    <div id="viewContainer">
      <canvas id="xyCanvas"></canvas>
      <canvas id="xzCanvas"></canvas>
      <canvas id="yzCanvas"></canvas>
      <canvas id="preview3D"></canvas>
    </div>

    <div id="sidebar">
      <h1>Metaball Editor</h1>
      <div class="hint">
        <p>
          XY (top) view: top-left, shaded isosurface.<br>
          XZ (side) view: bottom-left.<br>
          YZ (\"bottom folded up\") view: right, full height.<br>
          Click to select a metaball, drag to move it. Use the mouse wheel
          over a selected ball to adjust its radius.
        </p>
      </div>

      <h2>Metaballs</h2>
      <div id="ballList"></div>
      <div class="ball-actions">
        <button id="addBtn">Add Ball</button>
        <button id="addNegativeBtn">Add Negative</button>
        <button id="duplicateBtn" disabled>Duplicate</button>
        <button id="splitBtn" disabled>Split</button>
        <button id="togglePolarityBtn" disabled>Make Negative</button>
        <button id="removeBtn" disabled>Remove Selected</button>
      </div>
      <div class="hint">
        You can also press the <code>Delete</code> key to remove the selected ball.
      </div>

      <h2>Parameters</h2>
      <div class="control">
        <label>Threshold:
          <input type="number" id="threshold" min="0" step="0.1" value="1">
        </label>
      </div>
      <div class="control">
        <label>Resolution:
          <input type="number" id="res" min="10" max="400" step="10" value="120">
        </label>
      </div>

      <h2>Generated OpenSCAD</h2>
      <textarea id="scadcode"></textarea>
      <button id="importBtn" type="button">Import from SCAD</button>
      <div class="hint">
        Copy this code into OpenSCAD (with the BOSL2 library installed) to render your metaballs. You can also paste
        previously generated code here and click "Import", or drop a .scad file anywhere in the window to load it.
      </div>
    </div>
  </div>

  <div id="contextMenu" class="context-menu hidden">
    <button data-action="add">Add Ball</button>
    <button data-action="add-negative">Add Negative Ball</button>
    <button data-action="duplicate">Duplicate Ball</button>
    <button data-action="split">Split Ball</button>
    <button data-action="toggle">Make Negative</button>
    <button data-action="remove">Remove Ball</button>
  </div>

  <script type="module" src="main.js"></script>
</body>

</html>
